!function(t){function e(e){for(var a,r,i=e[0],l=e[1],d=e[2],s=0,f=[];s<i.length;s++)r=i[s],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&f.push(o[r][0]),o[r]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);for(u&&u(e);f.length;)f.shift()();return c.push.apply(c,d||[]),n()}function n(){for(var t,e=0;e<c.length;e++){for(var n=c[e],a=!0,i=1;i<n.length;i++){var l=n[i];0!==o[l]&&(a=!1)}a&&(c.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},o={2:0},c=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var i=window.webpackJsonp=window.webpackJsonp||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var d=0;d<i.length;d++)e(i[d]);var u=l;c.push([104,0,4]),n()}({104:function(t,e,n){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=a(n(12)),c=a(n(0)),r=n(105),i=document.getElementById("root");o.default.render(c.default.createElement(r.PageInfoMap,null),i)},105:function(t,e,n){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.PageInfoMap=void 0;var o=a(n(0)),c=n(106);e.PageInfoMap=function(){var t=o.default.useState("y"),e=(t[0],t[1]);return o.default.useEffect((function(){var t=new URL(window.location.href).searchParams.get("m");t&&e(t)}),[]),o.default.createElement(c.LeafletInfoMap,null)}},106:function(t,e,n){"use strict";var a=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var a,o=0,c=e.length;o<c;o++)!a&&o in e||(a||(a=Array.prototype.slice.call(e,0,o)),a[o]=e[o]);return t.concat(a||Array.prototype.slice.call(e))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.LeafletInfoMap=void 0;var c=o(n(0)),r=o(n(107));n(108),n(110),n(111);var i=r.default.tileLayer,l=r.default.map,d=r.default.MarkerClusterGroup,u=r.default.marker,s=r.default.DivIcon,f="1292036998:AAFkWJVt6GuU3-pyreWE-Xa8LMp4y9d0WgE",p={born:"Рождения",married:"Браки",died:"Умершие"},m=n(47)("1SQITOMPJN","2f1a6c924bc9f33235bb98e570053a79"),v=l(document.getElementById("map"),{zoomControl:!1});e.LeafletInfoMap=function(){var t=c.default.useState([]),e=t[0],n=t[1],o=c.default.useState([]),l=o[0],h=o[1],g=c.default.useState({}),b=g[0],y=g[1],_=c.default.useState(),k=_[0],E=_[1],C=c.default.useState([]),w=C[0],x=C[1],L=c.default.useState(),M=L[0],T=L[1],O=c.default.useState(new d({spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,animate:!0,maxClusterRadius:20,removeOutsideVisibleBounds:!0}))[0],j=new d({spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,animate:!0,maxClusterRadius:20,removeOutsideVisibleBounds:!0});return c.default.useEffect((function(){document.querySelector(".leaflet-bottom.leaflet-right").innerHTML="",v.setView([54.339248,29.39981],8);var t=r.default.layerGroup();i("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:10}).addTo(t),i("https://raw.githubusercontent.com/shappoff/storage/rkka_v4_and_2v_jan20/tiles/Z{z}/{y}/{x}.jpg",{minZoom:11,maxZoom:14}).addTo(t);var e=i("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:14}),n=i("https://raw.githubusercontent.com/shappoff/storage/rkka_v4_and_2v_jan20/tiles/Z{z}/{y}/{x}.jpg",{maxZoom:14}),a=(r.default.tileLayer("http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]}),r.default.tileLayer("http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]}));t.addTo(v);var o={"Смешанная карта":t,"РККА, Верстовка":n,"Современная карта":e,"Гугл Спутник":a},c={"Церкви":j,"Деревни":O};r.default.control.layers(o,c,{position:"topleft",collapsed:!1}).addTo(v),r.default.control.zoom({position:"bottomleft"}).addTo(v)}),[]),c.default.useEffect((function(){var t=m.initIndex("metricslocations"),e=[];M&&e.push(["tag_churches:".concat(M)]),t.search("",{filters:"_tags:no_geoloc",facetFilters:e}).then((function(t){var e=t.hits;h(e)}))}),[M]),c.default.useEffect((function(){var t=m.initIndex("metricslocations"),e=[];if(M&&e.push(["tag_churches:".concat(M)]),w.length){var o=[];w.forEach((function(t){o.push("tagid:".concat(t))})),e.push(a([],o,!0))}t.search("",{facets:["*"],filters:"_tags:geoloc",facetFilters:e}).then((function(t){var e=t.hits,a=t.facets;n(e),y(a)}))}),[M,w]),c.default.useEffect((function(){if(k){var t=r.default.control({position:"topleft"});return m.initIndex("metrics").search("",{facets:["_tags"],hitsPerPage:0,facetFilters:[[k?"_tags:".concat(k):""]]}).then((function(e){var n=e.facets;x(Object.keys(n._tags)),t.onAdd=function(e){var n=r.default.DomUtil.create("div","relations-reset-button"),a=document.createElement("span"),o=k.split(";")[0];a.innerHTML="Родственные связи: ".concat(o);var c=document.createElement("button");return c.innerText="X",c.addEventListener("click",(function(){E(""),x([]),e.removeControl(t)})),n.appendChild(a),n.appendChild(c),n},t.addTo(v)})),function(){v.removeControl(t)}}}),[k]),c.default.useEffect((function(){if(e&&(!e||e.length))return e.forEach((function(t){var e=t.title,n=t._geoloc,a=t.stats,o=t.short,c=t.uezd,i=t.volost,l=t.owner,d=t.type,p=t.mentions,m=void 0===p?[]:p,h=t.tagid,g=[];for(var b in a)a[b],g.push({year:b,count:a[b]});if(n&&n.lat){var y=n.lat,_=n.lng,k=u([y,_],{title:"".concat(d?"".concat(d," "):"").concat(e).concat(l?", ".concat(l," общество"):"").concat(i?", ".concat(i," волость"):"").concat(c?", ".concat(c," уезд"):""),icon:new s({html:"church"===d?"☦":"<b>".concat(o,"</b>"),className:"marker-".concat("church"===d?"church-":"","div-icon")})}),C=document.createElement("div"),w=document.createElement("b");w.innerHTML="<div>".concat(d," ").concat(e,"</div>"),C.appendChild(w);var x=document.createElement("div");x.innerText="".concat(l?"".concat(l," общество"):"").concat(i?", ".concat(i," волость"):"").concat(c?", ".concat(c," уезд"):""),C.appendChild(x);var L={},M={},T=[],j=[];for(var P in m)for(var I in M[P]||(M[P]=P),m[P])L[I]||(L[I]=I);for(var P in M)T.push("".concat(P," церковь;<br>"));for(var I in L)j.push(I);var A=document.createElement("div");A.innerHTML="<p>Упоминания:<br>".concat(T.join(""),"</p><p>Годы:<br>").concat(j.join("; "),"</p>"),C.appendChild(A);var B=document.createElement("div");B.innerText="сменить координаты",B.setAttribute("title","Сменить или уточнить геолокацию"),B.classList.add("indicate-button"),B.addEventListener("click",(function(){var t=document.getElementById("map");r.default.DomUtil.addClass(t,"crosshair-cursor-enabled");var n=function(a){var o=a.latlng,i=o.lat,l=o.lng,d="change: ".concat(c,";\n`").concat(e,"`;\n`").concat(i,", ").concat(l,"`\n[ordaOfBy](https://orda.of.by/.map/?").concat(i,",").concat(l,"&m=1v/14,wig/13,wig_v2/14,wig250/14,rkka/14,rkka_v2/14,rkka250/14,rkka2km/12,3v/13,3v_tmp56/13,3v_tmp71/13,kdwr/13,nem25/14,2v/13,polv/13,austr/13)");fetch("https://api.telegram.org/bot".concat(f,"/sendMessage?chat_id=").concat("162676802","&parse_mode=").concat("Markdown","&disable_web_page_preview=").concat(!0,"&text=").concat(encodeURIComponent(d))).then((function(){r.default.DomUtil.removeClass(t,"crosshair-cursor-enabled"),v.off("click",n),alert("Координаты отправлены!")}))};setTimeout((function(){v.on("click",n),k.closePopup()}))})),C.appendChild(B);var z=document.createElement("div");z.innerText="Родственные связи",z.setAttribute("title","Посмотреть родственные связи"),z.classList.add("indicate-button"),z.addEventListener("click",(function(){E(h),k.closePopup()})),C.appendChild(z),k.bindPopup(C),O.addLayer(k)}})),(M||w.length)&&v.fitBounds(O.getBounds()),function(){O.clearLayers()}}),[e]),c.default.useEffect((function(){return m.initIndex("metricschurches").search("",{facets:["*"]}).then((function(t){var e=t.hits;!e||e&&!e.length||(e.forEach((function(t){var e=t.title,n=t._geoloc,a=t.stat,o=t.uezd,c=t.np,i=t.notIndexed,l=[];if(n&&n.lat){var d=n.lat,m=n.lng,h=u([d,m],{title:"".concat(c?"".concat(c):"").concat(e?", ".concat(e):""),icon:new s({html:"☦",className:"marker-church-div-icon"})}),g=document.createElement("div"),b=document.createElement("b");b.innerText="".concat(c),g.appendChild(b);var y=document.createElement("b");y.innerHTML="<div>".concat(e,"</div>"),g.appendChild(y);var _=[];for(var k in a)p[k]&&_.push("<div>".concat(p[k]," - ").concat(a[k],"</div>"));l.push("<p>".concat(_.join(""),"</p>"));var E=[];a&&a.fods&&E.push("<div>ФОД (год):</div>".concat(Object.keys(a.fods).map((function(t){return'<span style="white-space: nowrap">'.concat(t,": ").concat(a.fods[t],"</span>")})).join("; "))),l.push("<p>".concat(E.join(""),"</p>"));var C=document.createElement("div");if(C.innerHTML="".concat(l.join("")),g.appendChild(C),i&&i.length){var w=document.createElement("p");w.innerHTML="Оцифрованы, но не проиндексированы:<br>".concat(i.join(",<br>")),g.appendChild(w)}var x=document.createElement("div");x.innerText="сменить координаты",x.setAttribute("title","Сменить или уточнить геолокацию"),x.classList.add("indicate-button"),x.addEventListener("click",(function(){var t=document.getElementById("map");r.default.DomUtil.addClass(t,"crosshair-cursor-enabled");var n=function(a){var c=a.latlng,i=c.lat,l=c.lng,d="change: ".concat(o,";\n`").concat(e,"`;\n`").concat(i,", ").concat(l,"`\n[ordaOfBy](https://orda.of.by/.map/?").concat(i,",").concat(l,"&m=1v/14,wig/13,wig_v2/14,wig250/14,rkka/14,rkka_v2/14,rkka250/14,rkka2km/12,3v/13,3v_tmp56/13,3v_tmp71/13,kdwr/13,nem25/14,2v/13,polv/13,austr/13)");fetch("https://api.telegram.org/bot".concat(f,"/sendMessage?chat_id=").concat("162676802","&parse_mode=").concat("Markdown","&disable_web_page_preview=").concat(!0,"&text=").concat(encodeURIComponent(d))).then((function(){r.default.DomUtil.removeClass(t,"crosshair-cursor-enabled"),v.off("click",n),alert("Координаты отправлены!")}))};setTimeout((function(){v.on("click",n),h.closePopup()}))})),g.appendChild(x),h.bindPopup(g,{minWidth:500}),j.addLayer(h)}})),v.addLayer(j),v.fitBounds(j.getBounds()))})),function(){v.removeLayer(j)}}),[]),c.default.useEffect((function(){var t=r.default.control({position:"topleft"});return b&&b.tag_churches&&(t.onAdd=function(t){var e=r.default.DomUtil.create("div","info uezd"),n=document.createElement("select");n.addEventListener("change",(function(t){T(~t.target.value.indexOf("церковь")?"":t.target.value)}));var a=document.createElement("option");a.innerText="церковь",a.setAttribute("value",""),n.appendChild(a);var o=Object.keys(b.tag_churches);return o.sort().forEach((function(t){var e=document.createElement("option");e.innerText=t,e.setAttribute("value",t),t!==M&&1!==o.length||e.setAttribute("selected","true"),n.appendChild(e)})),e.appendChild(n),e},t.addTo(v)),function(){v.removeControl(t)}}),[b.tag_churches]),c.default.useEffect((function(){var t={};l.sort((function(t,e){return t.title<e.title?-1:1})).forEach((function(e){e.tag_churches.forEach((function(n){t[n]?t[n].push("".concat(e.type?"".concat(e.type," "):"").concat(e.title)):t[n]=["".concat(e.type?"".concat(e.type," "):"").concat(e.title)]}))}));var e=r.default.control();return e.onAdd=function(t){return this._div=r.default.DomUtil.create("div","info-not-found-villages"),this.update(),this._div},e.update=function(e){var n=document.createElement("details"),a=document.createElement("summary");a.classList.add("root"),a.innerHTML="Список не найденных на карте н.п.",M&&n.setAttribute("open",null),n.appendChild(a);var o=document.createElement("ul");o.classList.add("churches-list"),Object.keys(t).sort().forEach((function(e){var n=document.createElement("li"),a=document.createElement("details"),c=document.createElement("summary");a.classList.add("church"),c.classList.add("church"),c.innerHTML="".concat(e," церковь"),M===e&&a.setAttribute("open",null),a.appendChild(c);var i=document.createElement("ul");i.setAttribute("style","max-height: 300px;overflow-y: scroll;");var l=function(n){var a=document.createElement("li"),o=document.createElement("details"),c=document.createElement("summary");o.classList.add("np"),c.classList.add("np"),c.setAttribute("value",t[e][n]),c.innerHTML="".concat(t[e][n]),o.appendChild(c);var l=document.createElement("div"),d=document.createElement("span");d.innerHTML="указать координаты",d.classList.add("indicate-button"),d.setAttribute("title","Указать геолокацию этого н.п."),d.addEventListener("click",(function(){a.classList.add("selected-for-coords");var o=document.getElementById("map");r.default.DomUtil.addClass(o,"crosshair-cursor-enabled");var c=function(i){a.classList.remove("selected-for-coords");var l=i.latlng,d=l.lat,u=l.lng,s="new: `".concat(t[e][n],"`;\n`").concat(d,", ").concat(u,"`\n[ordaOfBy](https://orda.of.by/.map/?").concat(d,",").concat(u,"&m=1v/14,wig/13,wig_v2/14,wig250/14,rkka/14,rkka_v2/14,rkka250/14,rkka2km/12,3v/13,3v_tmp56/13,3v_tmp71/13,kdwr/13,nem25/14,2v/13,polv/13,austr/13)");fetch("https://api.telegram.org/bot".concat(f,"/sendMessage?chat_id=").concat("162676802","&parse_mode=").concat("Markdown","&disable_web_page_preview=").concat(!0,"&text=").concat(encodeURIComponent(s))).then((function(){r.default.DomUtil.removeClass(o,"crosshair-cursor-enabled"),v.off("click",c),a.remove(),alert("Координаты отправлены!")}))};setTimeout((function(){v.on("click",c)}))})),l.appendChild(d),o.appendChild(l),a.appendChild(o),i.appendChild(a)};for(var d in t[e])l(d);a.appendChild(i),n.appendChild(a),o.appendChild(n)})),n.appendChild(o),this._div.appendChild(n)},e.addTo(v),function(){v.removeControl(e)}}),[l,M]),null}}});