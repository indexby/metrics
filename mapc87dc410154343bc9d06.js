!function(e){function t(t){for(var a,r,i=t[0],l=t[1],d=t[2],s=0,f=[];s<i.length;s++)r=i[s],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&f.push(o[r][0]),o[r]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(u&&u(t);f.length;)f.shift()();return c.push.apply(c,d||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],a=!0,i=1;i<n.length;i++){var l=n[i];0!==o[l]&&(a=!1)}a&&(c.splice(t--,1),e=r(r.s=n[0]))}return e}var a={},o={2:0},c=[];function r(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var i=window.webpackJsonp=window.webpackJsonp||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var d=0;d<i.length;d++)t(i[d]);var u=l;c.push([106,0,4]),n()}({106:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=a(n(12)),c=a(n(0)),r=n(107),i=document.getElementById("root");o.default.render(c.default.createElement(r.PageInfoMap,null),i)},107:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PageInfoMap=void 0;var o=a(n(0)),c=n(108);t.PageInfoMap=function(){var e=o.default.useState("y"),t=(e[0],e[1]);return o.default.useEffect((function(){var e=new URL(window.location.href).searchParams.get("m");e&&t(e)}),[]),o.default.createElement(c.LeafletInfoMap,null)}},108:function(e,t,n){"use strict";var a=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var a,o=0,c=t.length;o<c;o++)!a&&o in t||(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LeafletInfoMap=void 0;var c=o(n(0)),r=o(n(47));n(109),n(111),n(112),n(114),n(115),n(117),n(118);var i=r.default.tileLayer,l=r.default.map,d=r.default.MarkerClusterGroup,u=r.default.marker,s=r.default.DivIcon,f="1292036998:AAFkWJVt6GuU3-pyreWE-Xa8LMp4y9d0WgE",p={born:"Рождения",married:"Браки",died:"Умершие"},m=n(46)("1SQITOMPJN","2f1a6c924bc9f33235bb98e570053a79"),v=l(document.getElementById("map"),{zoomControl:!1});t.LeafletInfoMap=function(){var e=c.default.useState([]),t=e[0],n=e[1],o=c.default.useState([]),l=o[0],h=o[1],g=c.default.useState({}),b=g[0],y=g[1],_=c.default.useState(),k=_[0],E=_[1],C=c.default.useState([]),w=C[0],L=C[1],x=c.default.useState(),M=x[0],O=x[1],T=c.default.useState(new d({spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,animate:!0,maxClusterRadius:20,removeOutsideVisibleBounds:!0}))[0],j=new d({spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,animate:!0,maxClusterRadius:20,removeOutsideVisibleBounds:!0});return c.default.useEffect((function(){document.querySelector(".leaflet-bottom.leaflet-right").innerHTML="",v.setView([54.339248,29.39981],8);var e=r.default.layerGroup();i("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:10}).addTo(e),i("https://raw.githubusercontent.com/shappoff/storage/rkka_v4_and_2v_jan20/tiles/Z{z}/{y}/{x}.jpg",{minZoom:11,maxZoom:14}).addTo(e);var t=i("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:14}),n=i("https://raw.githubusercontent.com/shappoff/storage/rkka_v4_and_2v_jan20/tiles/Z{z}/{y}/{x}.jpg",{maxZoom:14}),a=(r.default.tileLayer("http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]}),r.default.tileLayer("http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]}));e.addTo(v);var o={"Смешанная карта":e,"РККА, Верстовка":n,"Современная карта":t,"Гугл Спутник":a},c={"Церкви":j,"Деревни":T};r.default.control.layers(o,c,{position:"topleft",collapsed:!0}).addTo(v),r.default.control.zoom({position:"bottomleft"}).addTo(v)}),[]),c.default.useEffect((function(){var e=m.initIndex("metricslocations"),t=[];M&&t.push(["tag_churches:".concat(M)]),e.search("",{filters:"_tags:no_geoloc",facetFilters:t}).then((function(e){var t=e.hits;h(t)}))}),[M]),c.default.useEffect((function(){var e=m.initIndex("metricslocations"),t=[];if(M&&t.push(["tag_churches:".concat(M)]),w.length){var o=[];w.forEach((function(e){o.push("tagid:".concat(e))})),t.push(a([],o,!0))}e.search("",{facets:["*"],filters:"_tags:geoloc",facetFilters:t}).then((function(e){var t=e.hits,a=e.facets;n(t),y(a)}))}),[M,w]),c.default.useEffect((function(){if(k){var e=r.default.control({position:"topleft"});return m.initIndex("metrics").search("",{facets:["_tags"],hitsPerPage:0,facetFilters:[[k?"_tags:".concat(k):""]]}).then((function(t){var n=t.facets;L(Object.keys(n._tags)),e.onAdd=function(t){var n=r.default.DomUtil.create("div","relations-reset-button"),a=document.createElement("span"),o=k.split(";")[0];a.innerHTML="Родственные связи: ".concat(o);var c=document.createElement("button");return c.innerText="X",c.addEventListener("click",(function(){E(""),L([]),t.removeControl(e)})),n.appendChild(a),n.appendChild(c),n},e.addTo(v)})),function(){v.removeControl(e)}}}),[k]),c.default.useEffect((function(){if(t&&(!t||t.length))return t.forEach((function(e){var t=e.title,n=e._geoloc,a=e.stats,o=e.short,c=e.uezd,i=e.volost,l=e.owner,d=e.type,p=e.mentions,m=void 0===p?[]:p,h=e.tagid,g=[];for(var b in a)a[b],g.push({year:b,count:a[b]});if(n&&n.lat){var y=n.lat,_=n.lng,k=u([y,_],{title:"".concat(d?"".concat(d," "):"").concat(t).concat(l?", ".concat(l," общество"):"").concat(i?", ".concat(i," волость"):"").concat(c?", ".concat(c," уезд"):""),icon:new s({html:"church"===d?"☦":"<b>".concat(o,"</b>"),className:"marker-".concat("church"===d?"church-":"","div-icon")})}),C=document.createElement("div"),w=document.createElement("b");w.innerHTML="<div>".concat(d," ").concat(t,"</div>"),C.appendChild(w);var L=document.createElement("div");L.innerText="".concat(l?"".concat(l," общество"):"").concat(i?", ".concat(i," волость"):"").concat(c?", ".concat(c," уезд"):""),C.appendChild(L);var x={},M={},O=[],j=[];for(var P in m)for(var I in M[P]||(M[P]=P),m[P])x[I]||(x[I]=I);for(var P in M)O.push("".concat(P," церковь;<br>"));for(var I in x)j.push(I);var B=document.createElement("div");B.innerHTML="<p>Упоминания:<br>".concat(O.join(""),"</p><p>Годы:<br>").concat(j.join("; "),"</p>"),C.appendChild(B);var S=document.createElement("div");S.innerText="сменить координаты",S.setAttribute("title","Сменить или уточнить геолокацию"),S.classList.add("indicate-button"),S.addEventListener("click",(function(){var e=document.getElementById("map");r.default.DomUtil.addClass(e,"crosshair-cursor-enabled");var n=function(a){var o=a.latlng,i=o.lat,l=o.lng,d="change: ".concat(c,";\n`").concat(t,"`;\n`").concat(i,", ").concat(l,"`\n[ordaOfBy](https://orda.of.by/.map/?").concat(i,",").concat(l,"&m=1v/14,wig/13,wig_v2/14,wig250/14,rkka/14,rkka_v2/14,rkka250/14,rkka2km/12,3v/13,3v_tmp56/13,3v_tmp71/13,kdwr/13,nem25/14,2v/13,polv/13,austr/13)");fetch("https://api.telegram.org/bot".concat(f,"/sendMessage?chat_id=").concat("162676802","&parse_mode=").concat("Markdown","&disable_web_page_preview=").concat(!0,"&text=").concat(encodeURIComponent(d))).then((function(){r.default.DomUtil.removeClass(e,"crosshair-cursor-enabled"),v.off("click",n),alert("Координаты отправлены!")}))};setTimeout((function(){v.on("click",n),k.closePopup()}))})),C.appendChild(S);var z=document.createElement("div");z.innerText="Родственные связи",z.setAttribute("title","Посмотреть родственные связи"),z.classList.add("indicate-button"),z.addEventListener("click",(function(){E(h),k.closePopup()})),C.appendChild(z),k.bindPopup(C),T.addLayer(k)}})),(M||w.length)&&setTimeout((function(){return v.fitBounds(T.getBounds())}),500),function(){T.clearLayers()}}),[t]),c.default.useEffect((function(){return m.initIndex("metricschurches").search("",{facets:["*"]}).then((function(e){var t=e.hits;!t||t&&!t.length||(t.forEach((function(e){var t=e.title,n=e._geoloc,a=e.stat,o=e.uezd,c=e.np,i=e.notIndexed,l=[];if(n&&n.lat){var d=n.lat,m=n.lng,h=u([d,m],{title:"".concat(c?"".concat(c):"").concat(t?", ".concat(t):""),icon:new s({html:"☦",className:"marker-church-div-icon"})}),g=document.createElement("div"),b=document.createElement("b");b.innerText="".concat(c),g.appendChild(b);var y=document.createElement("b");y.innerHTML="<div>".concat(t,"</div>"),g.appendChild(y);var _=[];for(var k in a)p[k]&&_.push("<div>".concat(p[k]," - ").concat(a[k],"</div>"));l.push("<p>".concat(_.join(""),"</p>"));var E=[];a&&a.fods&&E.push("<div>ФОД (год):</div>".concat(Object.keys(a.fods).map((function(e){return'<span style="white-space: nowrap">'.concat(e,": ").concat(a.fods[e],"</span>")})).join("; "))),l.push("<p>".concat(E.join(""),"</p>"));var C=document.createElement("div");if(C.innerHTML="".concat(l.join("")),g.appendChild(C),i&&i.length){var w=document.createElement("p");w.innerHTML="Оцифрованы, но не проиндексированы:<br>".concat(i.join(",<br>")),g.appendChild(w)}var L=document.createElement("div");L.innerText="сменить координаты",L.setAttribute("title","Сменить или уточнить геолокацию"),L.classList.add("indicate-button"),L.addEventListener("click",(function(){var e=document.getElementById("map");r.default.DomUtil.addClass(e,"crosshair-cursor-enabled");var n=function(a){var c=a.latlng,i=c.lat,l=c.lng,d="change: ".concat(o,";\n`").concat(t,"`;\n`").concat(i,", ").concat(l,"`\n[ordaOfBy](https://orda.of.by/.map/?").concat(i,",").concat(l,"&m=1v/14,wig/13,wig_v2/14,wig250/14,rkka/14,rkka_v2/14,rkka250/14,rkka2km/12,3v/13,3v_tmp56/13,3v_tmp71/13,kdwr/13,nem25/14,2v/13,polv/13,austr/13)");fetch("https://api.telegram.org/bot".concat(f,"/sendMessage?chat_id=").concat("162676802","&parse_mode=").concat("Markdown","&disable_web_page_preview=").concat(!0,"&text=").concat(encodeURIComponent(d))).then((function(){r.default.DomUtil.removeClass(e,"crosshair-cursor-enabled"),v.off("click",n),alert("Координаты отправлены!")}))};setTimeout((function(){v.on("click",n),h.closePopup()}))})),g.appendChild(L),h.bindPopup(g,{minWidth:500}),j.addLayer(h)}})),v.addLayer(j),v.fitBounds(j.getBounds()))})),function(){v.removeLayer(j)}}),[]),c.default.useEffect((function(){var e,t=r.default.control.search({layer:T,propertyLoc:"np",collapsed:!0,textPlaceholder:"Найти селение",autoCollapse:!0,zoom:13,filterData:function(e,t){var n=Object.keys(t).filter((function(t){return~t.toLowerCase().indexOf(e.toLowerCase())})),a={};return n.forEach((function(e){var n;Object.assign(a,((n={})[e]=t[e],n))})),a}});if(b&&b.tag_churches){var n=Object.keys(b.tag_churches).sort().map((function(e){return{label:e,value:e}})),o={label:"Все",value:"all"};e=r.default.control.select({position:"topleft",multi:!1,iconMain:"☦",id:"church-select-dropdown",selectedDefault:M?n.find((function(e){return e.value===M})).value:o.value,items:a([o],n,!0),onSelect:function(e){O("all"===e?"":e)}})}return t.on("search:expanded",(function(){v.hasLayer(T)||v.addLayer(T)})),v.addControl(t),e&&v.addControl(e),M||v.removeLayer(T),function(){v.removeControl(t),e&&v.removeControl(e)}}),[b.tag_churches]),c.default.useEffect((function(){var e={};l.sort((function(e,t){return e.title<t.title?-1:1})).forEach((function(t){t.tag_churches.forEach((function(n){e[n]?e[n].push("".concat(t.type?"".concat(t.type," "):"").concat(t.title)):e[n]=["".concat(t.type?"".concat(t.type," "):"").concat(t.title)]}))}));var t=r.default.control();return t.onAdd=function(e){return this._div=r.default.DomUtil.create("div","info-not-found-villages"),this.update(),this._div},t.update=function(t){var n=document.createElement("details"),a=document.createElement("summary");a.classList.add("root"),a.innerHTML="Список не найденных на карте селений",M&&n.setAttribute("open",null),n.appendChild(a);var o=document.createElement("ul");o.classList.add("churches-list"),Object.keys(e).sort().forEach((function(t){var n=document.createElement("li"),a=document.createElement("details"),c=document.createElement("summary");a.classList.add("church"),c.classList.add("church"),c.innerHTML="".concat(t," церковь"),M===t&&a.setAttribute("open",null),a.appendChild(c);var i=document.createElement("ul");i.setAttribute("style","max-height: 300px;overflow-y: scroll;");var l=function(n){var a=document.createElement("li"),o=document.createElement("details"),c=document.createElement("summary");o.classList.add("np"),c.classList.add("np"),c.setAttribute("value",e[t][n]),c.innerHTML="".concat(e[t][n]),o.appendChild(c);var l=document.createElement("div"),d=document.createElement("span");d.innerHTML="указать координаты",d.classList.add("indicate-button"),d.setAttribute("title","Указать геолокацию этого н.п."),d.addEventListener("click",(function(){a.classList.add("selected-for-coords");var o=document.getElementById("map");r.default.DomUtil.addClass(o,"crosshair-cursor-enabled");var c=function(i){a.classList.remove("selected-for-coords");var l=i.latlng,d=l.lat,u=l.lng,s="new: `".concat(e[t][n],"`;\n`").concat(d,", ").concat(u,"`\n[ordaOfBy](https://orda.of.by/.map/?").concat(d,",").concat(u,"&m=1v/14,wig/13,wig_v2/14,wig250/14,rkka/14,rkka_v2/14,rkka250/14,rkka2km/12,3v/13,3v_tmp56/13,3v_tmp71/13,kdwr/13,nem25/14,2v/13,polv/13,austr/13)");fetch("https://api.telegram.org/bot".concat(f,"/sendMessage?chat_id=").concat("162676802","&parse_mode=").concat("Markdown","&disable_web_page_preview=").concat(!0,"&text=").concat(encodeURIComponent(s))).then((function(){r.default.DomUtil.removeClass(o,"crosshair-cursor-enabled"),v.off("click",c),a.remove(),alert("Координаты отправлены!")}))};setTimeout((function(){v.on("click",c)}))})),l.appendChild(d),o.appendChild(l),a.appendChild(o),i.appendChild(a)};for(var d in e[t])l(d);a.appendChild(i),n.appendChild(a),o.appendChild(n)})),n.appendChild(o),this._div.appendChild(n)},t.addTo(v),function(){v.removeControl(t)}}),[l,M]),null}}});